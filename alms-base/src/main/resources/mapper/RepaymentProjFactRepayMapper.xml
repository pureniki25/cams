<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hongte.alms.base.mapper.RepaymentProjFactRepayMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.hongte.alms.base.entity.RepaymentProjFactRepay">
        <id column="proj_plan_detail_repay_id" property="projPlanDetailRepayId" />
        <result column="proj_plan_detail_id" property="projPlanDetailId" />
        <result column="proj_plan_list_id" property="projPlanListId" />
        <result column="plan_list_id" property="planListId" />
        <result column="project_id" property="projectId" />
        <result column="business_id" property="businessId" />
        <result column="orig_business_id" property="origBusinessId" />
        <result column="period" property="period" />
        <result column="after_id" property="afterId" />
        <result column="fee_id" property="feeId" />
        <result column="plan_item_name" property="planItemName" />
        <result column="plan_item_type" property="planItemType" />
        <result column="fact_amount" property="factAmount" />
        <result column="repay_source" property="repaySource" />
        <result column="fact_repay_date" property="factRepayDate" />
        <result column="repay_ref_id" property="repayRefId" />
        <result column="confirm_log_id" property="confirmLogId" />
        <result column="repay_source_id" property="repaySourceId" />
        <result column="is_cancelled" property="isCancelled" />
        <result column="create_date" property="createDate" />
        <result column="create_user" property="createUser" />
        <result column="update_date" property="updateDate" />
        <result column="update_user" property="updateUser" />
        <result column="settle_log_id" property="settleLogId" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        proj_plan_detail_repay_id AS projPlanDetailRepayId, proj_plan_detail_id AS projPlanDetailId, proj_plan_list_id AS projPlanListId, plan_list_id AS planListId, project_id AS projectId, business_id AS businessId, orig_business_id AS origBusinessId, period, after_id AS afterId, fee_id AS feeId, plan_item_name AS planItemName, plan_item_type AS planItemType, fact_amount AS factAmount, repay_source AS repaySource, fact_repay_date AS factRepayDate, repay_ref_id AS repayRefId, confirm_log_id AS confirmLogId, repay_source_id AS repaySourceId, is_cancelled AS isCancelled, create_date AS createDate, create_user AS createUser, update_date AS updateDate, update_user AS updateUser, settle_log_id AS settleLogId
    </sql>

	<select id="calFactRepay" resultType="java.math.BigDecimal">
		SELECT
			IFNULL( sum( fact_amount ), 0 ) 
		FROM
			tb_repayment_proj_fact_repay 
		WHERE
			business_id = #{businessId}
			AND after_id = #{afterId}
			AND plan_item_type = #{itemType}
			AND is_cancelled = 0 
			<if test="feeId !=null ">
				AND fee_id = #{feeId}
			</if>
	</select>
</mapper>
