<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hongte.alms.base.mapper.SysUserAreaMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.hongte.alms.base.entity.SysUserArea">
		<id column="id" property="id" />
		<result column="user_id" property="userId" />
		<result column="org_code" property="orgCode" />
		<result column="sequence" property="sequence" />
	</resultMap>

	<!-- 通用查询结果列 -->
	<sql id="Base_Column_List">
		id, user_id AS userId, org_code AS orgCode, sequence
	</sql>

	<select id="count" resultType="java.lang.Integer" >
		SELECT
			count(1)
		FROM
			tb_sys_user_area ua
		LEFT JOIN
			tb_sys_user u ON u.user_id = ua.user_id
		LEFT JOIN
			tb_basic_company c ON c.area_id = ua.org_code
		<where>
			1 = 1
			<if test="userId != null ">
				and ua.user_id = #{userId}
			</if>
			<if test="userName != null ">
				and u.user_name = #{userName}
			</if>
			<if test="areaId != null ">
				and (c.area_id = #{areaId} || c.area_name = #{areaId} )
			</if>
			<if test="areaLevel != null ">
				and c.area_level = #{areaLevel}
			</if>
		</where>

	</select>
	
	<select id="list" resultType="com.hongte.alms.base.vo.module.UserAreaVO" >
		SELECT
			ua.id as id ,
		    u.org_code as orgCode,
		    ua.user_id as userId,
		    u.user_name as userName,
		    c.area_name as areaName,
		    c.area_level as areaLevel,
		    c.area_id as areaId
		FROM
			tb_sys_user_area ua
		LEFT JOIN
			tb_sys_user u ON u.user_id = ua.user_id
		LEFT JOIN
			tb_basic_company c ON c.area_id = ua.org_code
		<where>
			1 = 1
			<if test="userId != null ">
				and ua.user_id = #{userId}
			</if>
			<if test="userName != null ">
				and u.user_name = #{userName}
			</if>
			<if test="areaId != null ">
				and (c.area_id = #{areaId} || c.area_name = #{areaId} || c.area_name like concat("%",#{areaId},"%") )
			</if>
			<!-- <if test="areaLevel != null ">
				and c.area_level = #{areaLevel}
			</if> -->
		</where>
		order by u.org_code,ua.user_id , c.area_level 
		<if test="page != null and limit != null">
			limit ${(page-1) * limit}, #{limit,jdbcType=DECIMAL}
		</if>
	</select>
</mapper>
